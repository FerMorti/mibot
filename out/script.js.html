<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: script.js</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: script.js</h1>

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>/**
 * Archivo script.js
 */

const { Telegraf } = require('telegraf');
const mitoken = require('./variables.js');
const bot = new Telegraf(mitoken);
const axios = require('axios');
const { obtenerJuegos } = require('./api.js');
const { Markup } = require('telegraf');

// Verificar si se est√° ejecutando con nodemon
if (process.env.NODE_ENV === 'development') {
    console.log('La aplicaci√≥n est√° ejecut√°ndose con nodemon.');
}

// Tu c√≥digo principal de la aplicaci√≥n aqu√≠...

/**
 * Teclado principal del bot.
 * @type {Markup}
 */
const commandKeyboard = Markup.keyboard([
    ['üéÆ Juegos Mensuales', 'üéÆ Juegos Semanales'],
    ['üìö Libros con Rating', 'üìö libros por G√©nero'],
    ['‚¨úOtros comandos‚¨ú']
]).resize();

/**
 * Teclado para seleccionar la plataforma de juegos.
 * @type {Markup}
 */
const juegosKeyboard = Markup.keyboard([
    ['PC', 'PS5', 'PS4'],
    ['Switch', 'XBX/S', 'XBO'],
    ['‚¨ÖÔ∏è Volver al men√∫ principal'] 
]).resize();

/**
 * Maneja los mensajes relacionados con las plataformas de juegos.
 * @param {Context} ctx Contexto del bot.
 */
bot.hears(['PC', 'PS5', 'PS4', 'Switch', 'XBX/S', 'XBO', '‚¨ÖÔ∏è Volver al men√∫ principal'], async (ctx) => {
    const plataforma = ctx.message.text;

    if (plataforma === '‚¨ÖÔ∏è Volver al men√∫ principal') {
        ctx.reply('¬°Hola! ' + ctx.from.first_name + ' ' + ctx.from.last_name + ' Soy un bot de noticias de videojuegos y libros. Usa los siguientes comandos para interactuar conmigo:', commandKeyboard);
        return; 
    }
    
    let tituloComando = 'Juegos Mensuales'; 

    if (ctx.message.reply_to_message &amp;&amp; ctx.message.reply_to_message.text) {
        tituloComando = ctx.message.reply_to_message.text.split(' ')[1];
    }
    
    const url = tituloComando === 'Juegos Mensuales' ? 'https://new-videogames-releases.p.rapidapi.com/getMonthGames' : 'https://new-videogames-releases.p.rapidapi.com/getWeekGames';
    await obtenerJuegos(url, plataforma, ctx, tituloComando);
});

/**
 * Mensaje inicial del bot.
 * @param {Context} ctx Contexto del bot.
 */
bot.start((ctx) => {
    ctx.reply('¬°Hola! ' + ctx.from.first_name + ' ' + ctx.from.last_name + ' Soy un bot de noticias de videojuegos y libros. Usa los siguientes comandos para interactuar conmigo:', commandKeyboard);
});

/**
 * Maneja el comando para mostrar los juegos mensuales.
 * @param {Context} ctx Contexto del bot.
 */
bot.hears('üéÆ Juegos Mensuales', (ctx) => {
    ctx.reply('Selecciona una plataforma:', juegosKeyboard);
});

/**
 * Maneja el comando para mostrar los juegos semanales.
 * @param {Context} ctx Contexto del bot.
 */
bot.hears('üéÆ Juegos Semanales', (ctx) => {
    ctx.reply('Selecciona una plataforma:', juegosKeyboard);
});

/**
 * Maneja el comando para mostrar los otros comandos disponibles.
 * @param {Context} ctx Contexto del bot.
 */
bot.hears('‚¨úOtros comandos‚¨ú', (ctx) => {
    ctx.reply('Estos son los otros comandos restantes: - /librosAutor - /librosTitulo (pulsa espacio tras el comando y escribe el nombre del titulo/autor (prueba: Wuthering Heights y Emily Bronte)de la obra)');
});

/**
 * Maneja el comando para mostrar los libros con rating.
 * @param {Context} ctx Contexto del bot.
 */
bot.hears('üìö Libros con Rating', async (ctx) => {
    try {
        const response = await axios.get('https://books-api7.p.rapidapi.com/books/find/rating', {
            params: {
                lte: '5',
                gte: '3.5',
                p: '1'
            },
            headers: {
                'X-RapidAPI-Key': '08c9f5fe2fmshb47964ce91c5b6ep1208ecjsn74025458e1b9',
                'X-RapidAPI-Host': 'books-api7.p.rapidapi.com'
            }
        });

        const librosTexto = response.data.map(libro => `${libro.title} - Autor: ${libro.author.first_name} ${libro.author.last_name} - Puntuaci√≥n: ${libro.rating}`).join('\n\n');
        
        ctx.reply(`√öltimos libros con puntuaci√≥n entre 3.5 y 5:\n\n${librosTexto}`);
    } catch (error) {
        console.error(error);
        ctx.reply('Ha ocurrido un error al procesar la solicitud de libros por rating.');
    }
});

/**
 * Maneja el comando para mostrar los libros por g√©nero.
 * @param {Context} ctx Contexto del bot.
 */
bot.hears('üìö libros por G√©nero', async (ctx) => {
    const generos = ['Fiction', 'Fantasy', 'Classics', 'Philosophy', 'Christian Fiction', 'Religion', 'Christianity', 'Faith', 'Theology', '‚¨ÖÔ∏è Volver al men√∫ principal'];
    const generosKeyboard = Markup.keyboard(generos, { columns: 2 }).resize();

    ctx.reply('Selecciona un g√©nero:', generosKeyboard);
});

/**
 * Maneja la selecci√≥n de g√©nero de libros.
 * @param {Context} ctx Contexto del bot.
 */
bot.hears(['Fiction', 'Fantasy', 'Classics', 'Philosophy', 'Christian Fiction', 'Religion', 'Christianity', 'Faith', 'Theology', '‚¨ÖÔ∏è Volver al men√∫ principal'], async (ctx) => {
    const genero = ctx.message.text;

    if (genero === '‚¨ÖÔ∏è Volver al men√∫ principal') {
        ctx.reply('¬°Hola! ' + ctx.from.first_name + ' ' + ctx.from.last_name + ' Soy un bot de noticias de videojuegos y libros. Usa los siguientes comandos para interactuar conmigo:', commandKeyboard);
        return; 
    }

    try {
        const response = await axios.get('https://books-api7.p.rapidapi.com/books/find/genres', {
            params: {
                'genres[]': [genero]
            },
            headers: {
                'X-RapidAPI-Key': '08c9f5fe2fmshb47964ce91c5b6ep1208ecjsn74025458e1b9',
                'X-RapidAPI-Host': 'books-api7.p.rapidapi.com'
            }
        });
        const librosTexto = response.data.slice(0, 10).map(libro => `${libro.title} - Autor: ${libro.author.first_name} ${libro.author.last_name} - G√©nero: ${genero}`).join('\n\n');
        ctx.reply(`Libros del g√©nero ${genero}:\n\n${librosTexto}`);
    } catch (error) {
        console.error(error);
        ctx.reply(`Ha ocurrido un error al procesar la solicitud de libros del g√©nero ${genero}.`);
    }
});

/**
 * Maneja el comando para buscar libros por t√≠tulo.
 * @param {Context} ctx Contexto del bot.
 */
bot.command('librosTitulo', async (ctx) => {
    const titulo = ctx.message.text.substring(14);
    try {
        const response = await axios.get('https://books-api7.p.rapidapi.com/books/find/title', {
            params: {
                title: titulo
            },
            headers: {
                'X-RapidAPI-Key': '08c9f5fe2fmshb47964ce91c5b6ep1208ecjsn74025458e1b9',
                'X-RapidAPI-Host': 'books-api7.p.rapidapi.com'
            }
        });
        if (response.data.length === 0) {
            ctx.reply(`No se encontraron libros con el t√≠tulo ${titulo}.`);
        } else {
            const librosTexto = response.data.map(libro => `${libro.title} - Autor: ${libro.author.first_name} ${libro.author.last_name}`).join('\n\n');
            ctx.reply(`Libros con t√≠tulo ${titulo}:\n\n${librosTexto}`);
        }
    } catch (error) {
        console.error(error);
        ctx.reply(`Ha ocurrido un error al procesar la solicitud de libros con el t√≠tulo ${titulo}.`);
    }
});

/**
 * Maneja el comando para buscar libros por autor.
 * @param {Context} ctx Contexto del bot.
 */
bot.command('librosAutor', async (ctx) => {
    const nombreAutor = ctx.message.text.substring(13);
    const [fname, lname] = nombreAutor.split(' ');
    try {
        const response = await axios.get('https://books-api7.p.rapidapi.com/books/find/author', {
            params: {
                lname: lname,
                fname: fname
            },
            headers: {
                'X-RapidAPI-Key': '08c9f5fe2fmshb47964ce91c5b6ep1208ecjsn74025458e1b9',
                'X-RapidAPI-Host': 'books-api7.p.rapidapi.com'
            }
        });
        if (response.data.length === 0) {
            ctx.reply(`No se encontraron libros del autor ${nombreAutor}.`);
        } else {
            const librosTexto = response.data.map(libro => `${libro.title} - G√©neros: ${libro.genres.join(', ')}`).join('\n\n');
            ctx.reply(`Libros del autor ${nombreAutor}:\n\n${librosTexto}`);
        }
    } catch (error) {
        console.error(error);
        ctx.reply(`Ha ocurrido un error al procesar la solicitud de libros del autor ${nombreAutor}.`);
    }
});

/**
 * Inicia el bot.
 */
bot.launch();
</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Global</h3><ul><li><a href="global.html#commandKeyboard">commandKeyboard</a></li><li><a href="global.html#juegosKeyboard">juegosKeyboard</a></li></ul>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc/jsdoc">JSDoc 4.0.2</a> on Mon Feb 19 2024 17:01:38 GMT+0100 (hora est√°ndar de Europa central)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
